# é¡¹ç›®è§„åˆ’ V2 å®Œæ•´éƒ¨ç½²æŒ‡å—

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

é¡¹ç›®è§„åˆ’ V2 æ˜¯å¯¹åŸæœ‰é¡¹ç›®è§„åˆ’æ¨¡å—çš„å…¨é¢å‡çº§ï¼Œä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š

### æ ¸å¿ƒåŠŸèƒ½
1. **å±‚çº§åŒ–ç®¡ç†**ï¼šæ”¯æŒæ¨¡å—â†’å­æ¨¡å—â†’ä»»åŠ¡çš„å¤šå±‚çº§ç»“æ„
2. **æ‹–æ‹½è°ƒæ•´**ï¼šå¯è§†åŒ–è°ƒæ•´æ¨¡å—å’Œä»»åŠ¡çš„å±‚çº§å…³ç³»
3. **ä¸°å¯Œå­—æ®µ**ï¼š
   - ä»»åŠ¡çŠ¶æ€ï¼šæœªå¼€å§‹/è¿›è¡Œä¸­/å·²å®Œæˆ/é˜»å¡/å·²å–æ¶ˆ
   - ä¼˜å…ˆçº§ï¼šä½/ä¸­/é«˜/ç´§æ€¥
   - å·¥æ—¶ç®¡ç†ï¼šè®¡åˆ’å·¥æ—¶ã€å®é™…å·¥æ—¶ï¼ˆå°æ—¶ä¸ºå•ä½ï¼‰
   - è´Ÿè´£äººã€è¯¦ç»†æè¿°ç­‰
4. **è¿›åº¦å¯è§†åŒ–**ï¼šå®æ—¶ç»Ÿè®¡æ€»ä½“è¿›åº¦ã€å·¥æ—¶æ¶ˆè€—
5. **å¿«é€Ÿæ“ä½œ**ï¼šä¸€é”®æ·»åŠ ã€æ‰¹é‡ç¼–è¾‘ã€å±•å¼€æ”¶èµ·

## äºŒã€éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šæ•°æ®åº“è¿ç§»

#### 1.1 åˆ›å»ºæ–°è¡¨ç»“æ„

```bash
# è¿æ¥åˆ°æ•°æ®åº“
mysql -h 9.134.95.57 -P 3306 -u xedv -p

# é€‰æ‹©æ•°æ®åº“
use xedv;

# æ‰§è¡Œè¿ç§»è„šæœ¬
source /path/to/robot-manage/backend/migrations/002_create_project_plan_v2_tables.sql
```

æˆ–è€…ä½¿ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆNavicatã€DBeaverç­‰ï¼‰æ‰§è¡ŒSQLæ–‡ä»¶ã€‚

#### 1.2 ï¼ˆå¯é€‰ï¼‰è¿ç§»æ—§æ•°æ®

å¦‚æœéœ€è¦å°†æ—§ç‰ˆé¡¹ç›®è§„åˆ’çš„æ•°æ®è¿ç§»åˆ°V2ç‰ˆæœ¬ï¼š

```bash
# æ‰§è¡Œæ•°æ®è¿ç§»è„šæœ¬
source /path/to/robot-manage/backend/migrations/migrate_v1_to_v2.sql
```

#### 1.3 ï¼ˆå¯é€‰ï¼‰æ’å…¥æµ‹è¯•æ•°æ®

```bash
# æ’å…¥æµ‹è¯•æ•°æ®
source /path/to/robot-manage/backend/migrations/003_insert_test_data_v2.sql
```

### æ­¥éª¤2ï¼šå®‰è£…å‰ç«¯ä¾èµ–

```bash
cd robot-manage/frontend
npm install vuedraggable@next
```

### æ­¥éª¤3ï¼šç¼–è¯‘é¡¹ç›®

#### 3.1 ç¼–è¯‘åç«¯

```bash
cd robot-manage/backend
go build -o robot-manage cmd/server/main.go
```

#### 3.2 ç¼–è¯‘å‰ç«¯

```bash
cd robot-manage/frontend
npm run build
```

#### 3.3 å¤åˆ¶å‰ç«¯æ–‡ä»¶

```bash
# åˆ é™¤æ—§çš„distç›®å½•
rm -rf robot-manage/backend/dist

# å¤åˆ¶æ–°çš„distç›®å½•
cp -r robot-manage/frontend/dist robot-manage/backend/
```

### æ­¥éª¤4ï¼šå¯åŠ¨æœåŠ¡

```bash
cd robot-manage/backend

# åœæ­¢æ—§æœåŠ¡ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
pkill robot-manage

# å¯åŠ¨æ–°æœåŠ¡
./robot-manage
```

### æ­¥éª¤5ï¼šéªŒè¯éƒ¨ç½²

è®¿é—®ä»¥ä¸‹åœ°å€éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸï¼š

- æ—§ç‰ˆé¡¹ç›®è§„åˆ’ï¼šhttp://localhost:8088/help/project-plan
- **æ–°ç‰ˆé¡¹ç›®è§„åˆ’V2**ï¼šhttp://localhost:8088/help/project-plan-v2

## ä¸‰ã€å¿«é€Ÿéƒ¨ç½²ï¼ˆä½¿ç”¨è„šæœ¬ï¼‰

æˆ‘ä»¬æä¾›äº†ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼š

```bash
cd /path/to/robot-manage
./deploy_v2.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œï¼š
1. æç¤ºæ‰§è¡Œæ•°æ®åº“è¿ç§»
2. ç¼–è¯‘åç«¯
3. å®‰è£…å‰ç«¯ä¾èµ–
4. ç¼–è¯‘å‰ç«¯
5. å¤åˆ¶æ–‡ä»¶åˆ°éƒ¨ç½²ç›®å½•

## å››ã€æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
```
backend/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â””â”€â”€ project_plan_v2.go          # V2æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â””â”€â”€ project_plan_v2_repository.go  # V2æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â””â”€â”€ project_plan_v2_service.go     # V2ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ handler/
â”‚   â”‚   â””â”€â”€ project_plan_v2_handler.go     # V2HTTPå¤„ç†å™¨
â”‚   â””â”€â”€ server/
â”‚       â”œâ”€â”€ router.go                      # è·¯ç”±é…ç½®ï¼ˆå·²æ›´æ–°ï¼‰
â”‚       â””â”€â”€ server.go                      # æœåŠ¡å™¨é…ç½®ï¼ˆå·²æ›´æ–°ï¼‰
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 002_create_project_plan_v2_tables.sql  # å»ºè¡¨è„šæœ¬
â”‚   â”œâ”€â”€ migrate_v1_to_v2.sql                   # æ•°æ®è¿ç§»è„šæœ¬
â”‚   â””â”€â”€ 003_insert_test_data_v2.sql            # æµ‹è¯•æ•°æ®è„šæœ¬
â””â”€â”€ bootstrap/
    â””â”€â”€ application.go                     # åº”ç”¨å¯åŠ¨ï¼ˆå·²æ›´æ–°ï¼‰
```

### å‰ç«¯æ–‡ä»¶
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ project-plan-v2.ts            # V2 APIæ¥å£
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â””â”€â”€ system/
â”‚   â”‚       â””â”€â”€ ProjectPlanV2View.vue     # V2ä¸»è§†å›¾
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ project-plan-v2/
â”‚   â”‚       â””â”€â”€ ModuleNode.vue            # æ¨¡å—èŠ‚ç‚¹ç»„ä»¶
â”‚   â””â”€â”€ router/
â”‚       â””â”€â”€ index.ts                      # è·¯ç”±é…ç½®ï¼ˆå·²æ›´æ–°ï¼‰
â””â”€â”€ package.json                          # ä¾èµ–é…ç½®ï¼ˆå·²æ›´æ–°ï¼‰
```

## äº”ã€APIæ¥å£æ–‡æ¡£

### 5.1 è·å–æ¨¡å—æ ‘
```
GET /api/v1/project-plan-v2/tree
```

å“åº”ç¤ºä¾‹ï¼š
```json
[
  {
    "id": 1,
    "parent_id": null,
    "name": "å‰ç«¯å¼€å‘",
    "icon": "ğŸ¨",
    "sort_order": 1,
    "children": [
      {
        "id": 2,
        "parent_id": 1,
        "name": "é¡µé¢å¼€å‘",
        "icon": "ğŸ“„",
        "children": [],
        "items": [
          {
            "id": 1,
            "module_id": 2,
            "name": "é¡¹ç›®è§„åˆ’V2é¡µé¢",
            "status": "completed",
            "priority": "high",
            "owner": "å¼ ä¸‰",
            "planned_hours": 16,
            "actual_hours": 18,
            "description": "å®ç°å±‚çº§åŒ–çš„é¡¹ç›®è§„åˆ’ç®¡ç†é¡µé¢"
          }
        ]
      }
    ],
    "items": []
  }
]
```

### 5.2 åˆ›å»ºæ¨¡å—
```
POST /api/v1/project-plan-v2/modules
Content-Type: application/json

{
  "name": "æ–°æ¨¡å—",
  "icon": "ğŸ“¦",
  "parent_id": null,
  "sort_order": 1
}
```

### 5.3 æ›´æ–°æ¨¡å—
```
PUT /api/v1/project-plan-v2/modules/:id
Content-Type: application/json

{
  "name": "æ›´æ–°åçš„æ¨¡å—å",
  "icon": "ğŸ¯",
  "parent_id": 1,
  "sort_order": 2
}
```

### 5.4 åˆ é™¤æ¨¡å—
```
DELETE /api/v1/project-plan-v2/modules/:id
```

### 5.5 åˆ›å»ºä»»åŠ¡
```
POST /api/v1/project-plan-v2/items
Content-Type: application/json

{
  "module_id": 1,
  "name": "æ–°ä»»åŠ¡",
  "status": "not_started",
  "priority": "medium",
  "owner": "å¼ ä¸‰",
  "planned_hours": 8,
  "actual_hours": null,
  "description": "ä»»åŠ¡è¯¦ç»†æè¿°",
  "sort_order": 1
}
```

### 5.6 æ›´æ–°ä»»åŠ¡
```
PUT /api/v1/project-plan-v2/items/:id
Content-Type: application/json

{
  "status": "completed",
  "actual_hours": 10
}
```

### 5.7 åˆ é™¤ä»»åŠ¡
```
DELETE /api/v1/project-plan-v2/items/:id
```

### 5.8 æ‰¹é‡æ›´æ–°
```
POST /api/v1/project-plan-v2/modules/batch
POST /api/v1/project-plan-v2/items/batch
```

## å…­ã€ä½¿ç”¨è¯´æ˜

### 6.1 æ·»åŠ é¡¶çº§æ¨¡å—
1. ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„"æ·»åŠ æ¨¡å—"æŒ‰é’®
2. è¾“å…¥æ¨¡å—åç§°å’Œå›¾æ ‡ï¼ˆemojiï¼‰
3. ç‚¹å‡»ä¿å­˜

### 6.2 æ·»åŠ å­æ¨¡å—
1. åœ¨æ¨¡å—å¡ç‰‡ä¸Šæ‰¾åˆ°"å­æ¨¡å—"æŒ‰é’®
2. ç‚¹å‡»åè¾“å…¥å­æ¨¡å—ä¿¡æ¯
3. ä¿å­˜åä¼šè‡ªåŠ¨å½’å±åˆ°çˆ¶æ¨¡å—ä¸‹

### 6.3 æ·»åŠ ä»»åŠ¡
1. åœ¨æ¨¡å—å¡ç‰‡ä¸Šç‚¹å‡»"ä»»åŠ¡"æŒ‰é’®
2. å¡«å†™ä»»åŠ¡è¯¦ç»†ä¿¡æ¯ï¼š
   - åç§°ï¼ˆå¿…å¡«ï¼‰
   - çŠ¶æ€ã€ä¼˜å…ˆçº§
   - è´Ÿè´£äºº
   - è®¡åˆ’å·¥æ—¶ã€å®é™…å·¥æ—¶
   - è¯¦ç»†æè¿°
3. ä¿å­˜

### 6.4 å¿«é€Ÿæ›´æ–°çŠ¶æ€
åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­ï¼Œç›´æ¥ç‚¹å‡»çŠ¶æ€ä¸‹æ‹‰æ¡†å³å¯å¿«é€Ÿæ›´æ–°ä»»åŠ¡çŠ¶æ€ã€‚

### 6.5 å±•å¼€/æ”¶èµ·
- ç‚¹å‡»"å±•å¼€å…¨éƒ¨"æŒ‰é’®å±•å¼€æ‰€æœ‰æ¨¡å—
- ç‚¹å‡»"æ”¶èµ·å…¨éƒ¨"æŒ‰é’®æ”¶èµ·æ‰€æœ‰æ¨¡å—
- ç‚¹å‡»æ¨¡å—å‰çš„ç®­å¤´å›¾æ ‡å¯å•ç‹¬å±•å¼€/æ”¶èµ·

### 6.6 ç¼–è¾‘å’Œåˆ é™¤
- ç‚¹å‡»ç¼–è¾‘å›¾æ ‡ä¿®æ”¹æ¨¡å—æˆ–ä»»åŠ¡
- ç‚¹å‡»åˆ é™¤å›¾æ ‡åˆ é™¤ï¼ˆåˆ é™¤æ¨¡å—ä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰å­æ¨¡å—å’Œä»»åŠ¡ï¼‰

## ä¸ƒã€æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿ç§»**ï¼šå¿…é¡»å…ˆæ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼Œå¦åˆ™æœåŠ¡æ— æ³•å¯åŠ¨
2. **ä¾èµ–å®‰è£…**ï¼šç¡®ä¿å®‰è£…äº† vuedraggable@next ä¾èµ–
3. **æ•°æ®å¤‡ä»½**ï¼šå»ºè®®åœ¨è¿ç§»å‰å¤‡ä»½æ•°æ®åº“
4. **æƒé™é…ç½®**ï¼šç¡®ä¿ç”¨æˆ·æœ‰è®¿é—®æ–°è·¯ç”±çš„æƒé™
5. **æµè§ˆå™¨å…¼å®¹**ï¼šå»ºè®®ä½¿ç”¨Chromeã€Firefoxã€Edgeç­‰ç°ä»£æµè§ˆå™¨

## å…«ã€æ•…éšœæ’æŸ¥

### 8.1 æœåŠ¡å¯åŠ¨å¤±è´¥
- æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®
- ç¡®è®¤æ•°æ®åº“è¡¨å·²åˆ›å»º
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`backend/logs/app.log`

### 8.2 é¡µé¢æ— æ³•è®¿é—®
- ç¡®è®¤å‰ç«¯æ–‡ä»¶å·²æ­£ç¡®å¤åˆ¶åˆ° `backend/dist` ç›®å½•
- æ£€æŸ¥è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### 8.3 APIè¯·æ±‚å¤±è´¥
- æ£€æŸ¥JWT tokenæ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤APIè·¯ç”±å·²æ­£ç¡®æ³¨å†Œ
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚

### 8.4 æ‹–æ‹½åŠŸèƒ½ä¸å·¥ä½œ
- ç¡®è®¤ vuedraggable ä¾èµ–å·²å®‰è£…
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

## ä¹ã€åç»­ä¼˜åŒ–è®¡åˆ’

1. å®Œå–„æ‹–æ‹½æ’åºåŠŸèƒ½çš„åç«¯ä¿å­˜
2. æ·»åŠ ç”˜ç‰¹å›¾è§†å›¾
3. æ”¯æŒä»»åŠ¡ä¾èµ–å…³ç³»
4. æ·»åŠ ä»»åŠ¡è¯„è®ºåŠŸèƒ½
5. æ”¯æŒæ–‡ä»¶é™„ä»¶ä¸Šä¼ 
6. æ·»åŠ ä»»åŠ¡æé†’å’Œé€šçŸ¥
7. æ”¯æŒå¯¼å‡ºExcelæŠ¥è¡¨
8. æ·»åŠ ä»»åŠ¡æ—¶é—´çº¿è§†å›¾
9. æ”¯æŒä»»åŠ¡æ¨¡æ¿
10. æ·»åŠ å·¥æ—¶ç»Ÿè®¡æŠ¥è¡¨

## åã€æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›®æ–‡æ¡£ï¼š`PROJECT_PLAN_V2_README.md`
- éƒ¨ç½²è„šæœ¬ï¼š`deploy_v2.sh`
- æ•°æ®åº“è„šæœ¬ï¼š`backend/migrations/`

æˆ–è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒã€‚
